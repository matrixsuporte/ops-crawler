<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">           
    <title>Crawler OPS - Secretários Parlamentares</title>    
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" /> 	
	<style>
		/* Move down content because we have a fixed navbar that is 50px tall */
		body 
		{
		  padding-top: 50px;
		  padding-bottom: 20px;
		}
		/* This imageless css button was generated by CSSButtonGenerator.com */	
		.luzApagada
		{
			display: none;
			position:absolute;
			top: 0%;
			left: 0%;
			width: 100%;
			height: 100%;
			background-color: white;
			z-index:1001;
			-moz-opacity: 0.9;
			opacity:.90;
			filter: alpha(opacity=90)
		}
		.luzAcesa
		{
			display: none;
			position: absolute;			
			background-color: white;
			z-index:1002;
			overflow: auto;
		}
		.mensagens{
			height: 200px;
			overflow-y:scroll; 
		}	
  </style>	
  </head>
  <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">          
          <a class="navbar-brand" href="#">Crawler Secretários</a>
        </div>        
      </div>
    </nav>        
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2 class="page-header">
                    Como funciona?					
                </h2>                
				<p>Ao clicar no botão de iniciar, uma raspagem de dados será feita na  
				 <a href="http://www2.camara.leg.br/transparencia/recursos-humanos/quadro-remuneratorio/consulta-secretarios-parlamentares/layouts_transpar_quadroremuner_consultaSecretariosParlamentares">
				 listagem de secretarios</a> do Senado Federal. E na <a href="http://www2.camara.leg.br/transparencia/sispush/indexAtuacao">listagem de atuação</a>
				 de nossos parlamentares em atividade no momento.			
				</p> 			   
				<p>Infelizmente, os dados nas páginas não estão estruturados.Em uma listagem os deputados são listados por <b>lotação</b>. 
				   E em outros eles estão listados pelo seu número de cadastro. Este Crawler tenta fazer o possível para ligar os dois pontos, 
				   porém em algumas situações os nomes cadastrados possuem diferença, para estes parlamentares não é possível realizar 
				   a análise dos dados.
				</p>
				<p>No final da execução o realiza 3 listagens. Os secretários com lotação e id de cadastro consolidados, os parlamentares que não tiveram 
				   condição de serem analisados e uma listagem  total dos parlamentares. Estas listagens estão em formato json. 				
				</p>   
				<p>
					<button id="iniciarCrawler" type="button" class="btn btn-danger" onclick="iniciarCrawler()">Iniciar</button>  
				</p>				
				<p>
					<ul class="mensagens" id="messages">									
					</ul>
					<ul id="ulRotas">						
						<li><a target='_blank' href='https://mrcrawler.herokuapp.com/Secretarios'>Secretários encontrados</a></li>					
						<li><a target='_blank' href='https://mrcrawler.herokuapp.com/NaoEncontrados'>Parlamentares não encontrados</a></li>
						<li><a target='_blank' href='https://mrcrawler.herokuapp.com/Parlamentares'>Parlamentares</a></li>
					</ul>				
				</p>
            </div>
	    </div>      
    </div> <!-- /container -->        	
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>	
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>	
	<script>
      var socket = io();
	  var etapa = 0; 
	  $("#ulRotas").hide();	  
      function iniciarCrawler()
	  {
		socket.emit('chat message', 'etapa'+ etapa);
	  }  
      socket.on('chat message', function(msg)
	  {        
		if((msg === "proxima") || (msg === "fim"))
		{
			if(msg === "fim")
			{
				alert('Fim da execução. Para recuperar os resultados, acesse as rotas indicadas no fim do Scroll'); 
				$("#ulRotas").show();	  
			}else{  			
				etapa++;
				socket.emit('chat message', 'etapa'+ etapa);
			}
		}else{
			$('#messages').append($('<li>').text(msg));
		}			
      });
    </script>
  </body>
</html>
